# 📋 Google Sheets 手動設置指南

## 目的

在完成程式碼部署後，需要**手動在 Google Sheets 中設置照片功能**，以便系統能夠正確儲存和顯示借用設備的照片。

---

## 設置步驟

### 1. 開啟您的 Google Sheets

前往：https://docs.google.com/spreadsheets/d/1jcvw1Hfv_9oO2OhFT6huOPhMtnBr_hlR6TJv_8pr6U4/edit

### 2. 找到 **records** 工作表

點擊底部的 `records` 分頁標籤

### 3. 新增欄位標題

在現有欄位後面新增兩個欄位：

| 欄位 | 標題 | 說明 |
|------|------|------|
| A | borrowerId | （現有）借用人學號 |
| B | gear | （現有）設備名稱 |
| C | borrowTime | （現有）借用時間 |
| D | returnTime | （現有）歸還時間 |
| **E** | **photoUrl** | **（新增）照片網址** |
| **F** | **照片預覽** | **（新增）圖片顯示** |

#### 操作：
- 在 **E1** 儲存格輸入：`photoUrl`
- 在 **F1** 儲存格輸入：`照片預覽`

### 4. 設定 IMAGE 公式

在 **F2** 儲存格輸入以下公式：

```
=IF(E2<>"", IMAGE(E2, 4, 80, 80), "")
```

#### 公式說明：
- `E2<>""` - 檢查 E2 欄位（photoUrl）是否有值
- `IMAGE(E2, 4, 80, 80)` - 如果有值，顯示圖片
  - 參數 1：圖片 URL（從 E2 取得）
  - 參數 2：`4` 代表自訂尺寸
  - 參數 3：寬度 `80` 像素
  - 參數 4：高度 `80` 像素
- `""` - 如果沒有值，顯示空白

### 5. 複製公式到所有列

1. 選中 **F2** 儲存格
2. 將滑鼠移到儲存格右下角的小藍點
3. 按住左鍵向下拖曳，複製公式到所有資料列（建議拖曳到至少 F100）

### 6. 調整欄寬（選用）

為了更好地顯示圖片：
- 將 **E 欄**（photoUrl）寬度調整為約 **300 像素**（方便查看完整 URL）
- 將 **F 欄**（照片預覽）寬度調整為約 **100 像素**（配合 80x80 圖片顯示）

調整方法：
1. 將滑鼠移到欄位標題之間的分隔線
2. 按住左鍵左右拖曳即可調整寬度

---

## 完成後的表格結構

```
┌────────────┬──────┬─────────────┬─────────────┬──────────────────────────┬──────────┐
│ borrowerId │ gear │ borrowTime  │ returnTime  │ photoUrl                 │ 照片預覽 │
├────────────┼──────┼─────────────┼─────────────┼──────────────────────────┼──────────┤
│ S1234567   │ 相機 │ 2024-01-15  │             │ https://drive.google...  │ [圖片]   │
│ S1234568   │ 腳架 │ 2024-01-15  │ 2024-01-15  │ https://drive.google...  │ [圖片]   │
│ S1234569   │ 麥克風│ 2024-01-16  │             │                          │          │
└────────────┴──────┴─────────────┴─────────────┴──────────────────────────┴──────────┘
```

---

## 測試照片功能

設置完成後，您可以：

1. **在前端網頁借用設備時拍照**
   - 輸入借用人學號和設備條碼
   - 點擊「拍照或選擇照片」按鈕
   - 拍照或選擇圖片後，會顯示預覽
   - 點擊「借出」按鈕

2. **查看 Sheets 中的照片**
   - 前往 records 工作表
   - E 欄會自動填入 Drive 照片 URL
   - F 欄會自動顯示 80x80 的照片縮圖

3. **在前端查看記錄中的照片**
   - 切換到「設備狀態」或「借用記錄」標籤
   - 有照片的記錄會顯示「查看照片」按鈕
   - 點擊按鈕會在新分頁開啟完整照片

---

## 常見問題

### Q1: F 欄顯示 #VALUE! 錯誤？
**A:** 請確認：
- E 欄的 URL 是否有效（必須是 `https://drive.google.com/uc?id=...` 格式）
- IMAGE 公式是否正確輸入（注意英文半形標點）

### Q2: 照片顯示「無法載入圖片」？
**A:** 可能原因：
- Drive 檔案權限未設為「知道連結的任何人都能檢視」
- URL 格式錯誤（需使用 `/uc?id=` 格式）

### Q3: 要如何調整照片大小？
**A:** 修改 F2 公式中的數字：
```
=IF(E2<>"", IMAGE(E2, 4, 寬度, 高度), "")
```
例如改為 `IMAGE(E2, 4, 120, 120)` 顯示 120x120 像素

---

## 進階設定（選用）

### 條件格式：突顯有照片的記錄

1. 選擇整個 E 欄（photoUrl）
2. 點選「格式」→「條件式格式設定」
3. 設定規則：
   - **套用至範圍**：`E2:E1000`
   - **格式規則**：「不是空白」
   - **格式樣式**：背景顏色設為淺綠色
4. 點選「完成」

這樣有照片的記錄會以綠色背景突顯。

---

## 需要協助？

如果遇到問題，請檢查：
1. ✅ E 欄標題是否為 `photoUrl`
2. ✅ F 欄公式是否正確
3. ✅ 公式是否已複製到所有列
4. ✅ Google Drive 照片權限是否正確設定

---

**設置完成後，照片功能即可正常使用！** 🎉
